import{a as Ee}from"./chunk-GKQS6KW6.js";import{a as _e}from"./chunk-GPZHJRK5.js";import{a as Ce}from"./chunk-O3SRXZ6G.js";import{b as ge}from"./chunk-LFWRBZZV.js";import{a as he,b as be}from"./chunk-PNAF5FZM.js";import{A as ue,n as ae,q as se,t as pe,u as me,x as de,y as ce}from"./chunk-SMT4EN3V.js";import"./chunk-XFY4HXS5.js";import"./chunk-ETRWT4GR.js";import"./chunk-KWA6YC6W.js";import{a as we}from"./chunk-RJCMGSDU.js";import{a as Re}from"./chunk-JLVC7EHP.js";import"./chunk-BTHN5K7B.js";import{c as J,d as Y,e as Z}from"./chunk-BVAXM6NJ.js";import{d as Se,e as ve}from"./chunk-INLTFKLG.js";import{b as fe}from"./chunk-L5ASE5JY.js";import"./chunk-WRM6PFBH.js";import{a as z,c as $,d as ee,h as te,i as ie}from"./chunk-AWHW4APH.js";import{m as M}from"./chunk-ATPXQBBY.js";import{Ia as O,Ja as A,La as H,Ma as W,Na as j,Oa as V,Qa as q,Ta as U,Ua as K,Xa as Q,Ya as X,ob as oe,pb as re,rb as ne,sb as le}from"./chunk-6PJPRA3Z.js";import{$b as y,Cb as o,Db as r,Eb as u,Ib as C,Kb as b,Lb as S,Ta as l,U as E,Ua as T,Wb as G,Xb as c,Yb as R,Yc as N,Zb as h,ac as I,bc as L,dc as w,eb as B,fb as x,ga as f,ha as g,lb as D,nc as a,oc as s,rc as v,tb as p,wb as k}from"./chunk-JPVIOWP6.js";import"./chunk-EQDQRRRY.js";var ye=()=>["roleName"],Ie=()=>({"min-width":"75rem"}),Le=()=>[10,20,30],Ne=()=>({width:"450px"});function Pe(n,e){if(n&1){let t=C();o(0,"div",22)(1,"p-button",23),a(2,"translate"),b("onClick",function(){f(t);let m=S();return g(m.openNew())}),r(),o(3,"p-button",24),a(4,"translate"),b("onClick",function(){f(t);let m=S();return g(m.deleteSelectedRoles())}),r()()}if(n&2){let t=S();l(),p("label",s(2,3,"ADD")),l(2),p("label",s(4,5,"DELETE"))("disabled",!t.selectedRoles||!t.selectedRoles.length)}}function Fe(n,e){n&1&&(u(0,"p-button",25),a(1,"translate")),n&2&&p("label",s(1,1,"EXPORT"))}function De(n,e){if(n&1){let t=C();o(0,"div",26)(1,"h5",27),c(2),a(3,"translate"),r(),o(4,"p-iconfield"),u(5,"p-inputicon",28),o(6,"input",29),a(7,"translate"),b("input",function(m){f(t);let _=S(),d=G(6);return g(_.onGlobalFilter(d,m))}),r()()()}n&2&&(l(2),R(s(3,2,"ROLES")),l(4),p("placeholder",s(7,4,"SEARCH_PACEHOLDER")))}function Me(n,e){n&1&&(o(0,"tr")(1,"th",30),u(2,"p-tableHeaderCheckbox"),r(),o(3,"th",31),c(4),a(5,"translate"),u(6,"p-sortIcon",32),r(),o(7,"th",33),c(8),a(9,"translate"),u(10,"p-sortIcon",34),r(),o(11,"th"),c(12),a(13,"translate"),r(),o(14,"th"),c(15),a(16,"translate"),r()()),n&2&&(l(4),h(" ",s(5,4,"NAME")," "),l(4),h(" ",s(9,6,"DESCRIPTION")," "),l(4),h(" ",s(13,8,"PERMISSIONS")," "),l(3),h(" ",s(16,10,"OPTIONS")," "))}function Ve(n,e){if(n&1){let t=C();o(0,"tr")(1,"td",30),u(2,"p-tableCheckbox",35),r(),o(3,"td"),c(4),r(),o(5,"td"),c(6),r(),o(7,"td"),c(8),r(),o(9,"td")(10,"div",36)(11,"p-button",37),a(12,"translate"),b("onClick",function(){let m=f(t).$implicit,_=S();return g(_.editRole(m))}),r()()()()}if(n&2){let t=e.$implicit;l(2),p("value",t),l(2),h(" ",t.roleName," "),l(2),h(" ",t.description," "),l(2),h(" ",t.permissions.length," "),l(3),p("pTooltip",s(12,7,"EDIT"))("rounded",!0)("outlined",!0)}}var P=class n{constructor(e,t,i){this.roleService=e;this.toast=t;this.translate=i}roleDialog=!1;dialogHeader="Create Role";loading=!1;saveLoading=!1;pageReq=new Ce(0,10);pageDetails;roleList=[];role;selectedRoles;cols;roleForm;permList=[];selectedPerms=[];mode;ngOnInit(){this.getRoles(),this.getPermissions(),this.initRoleForm()}getRoles(){this.roleService.getAllRoles().subscribe(e=>{e.success&&(this.roleList=e.data)})}getPermissions(){this.roleService.getPermissionGroups().subscribe(e=>{e.success&&(this.permList=this.mapPermissionsToTreeData(e.data))})}initRoleForm(){this.roleForm=new j({roleName:new V(null,[A.required]),description:new V(null)})}onSaveRole(){if(this.saveLoading=!0,this.roleForm.invalid){this.toast.showWarn(this.translate.instant("REQUIRED_FIELDS_MSG"));return}this.mode=="create"?this.roleService.createRole({roleName:this.roleForm.value.roleName,description:this.roleForm.value.description,permissionsIDs:this.selectedPerms.filter(e=>e.data!="group").map(e=>e.data)}).subscribe(e=>{e.success?(this.toast.showSuccess(this.translate.instant("SAVE_SUCCESS")),this.getRoles(),this.roleForm.reset(),this.selectedPerms=[],this.roleDialog=!1):this.toast.showError(e.message),this.saveLoading=!1}):this.mode=="update"&&this.role&&this.roleService.updateRole({roleId:this.role.roleId,roleName:this.roleForm.value.roleName,description:this.roleForm.value.description,permissionsIDs:this.selectedPerms.filter(e=>e.data!="group").map(e=>e.data)}).subscribe(e=>{e.success?(this.toast.showSuccess(this.translate.instant("SAVE_SUCCESS")),this.getRoles(),this.roleForm.reset(),this.selectedPerms=[],this.roleDialog=!1):this.toast.showError(e.message),this.saveLoading=!1})}mapPermissionsToTreeData(e){return e.map(t=>({label:this.translate.instant(t.group),data:"group",children:t.permissions.map(i=>({label:this.translate.instant(i.permName),data:i.permId,expanded:!1}))}))}editRole(e){this.mode="update",this.dialogHeader=this.translate.instant("EDIT_ROLE",{name:e.roleName}),this.roleDialog=!0,this.role=e,this.roleForm.patchValue({roleName:e.roleName,description:e.description})}openNew(){this.mode="create",this.dialogHeader=this.translate.instant("ADD_ROLE"),this.roleDialog=!0}deleteSelectedRoles(){}onGlobalFilter(e,t){e.filterGlobal(t.target.value,"contains")}static \u0275fac=function(t){return new(t||n)(T(Ee),T(Re),T(J))};static \u0275cmp=B({type:n,selectors:[["app-role-list"]],decls:36,vars:38,consts:[["start",""],["end",""],["dt",""],["caption",""],["header",""],["body",""],["styleClass","mb-6"],["dataKey","roleId","paginator","true","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} roles",3,"selectionChange","value","rows","columns","loading","globalFilterFields","tableStyle","selection","rowHover","showCurrentPageReport","rowsPerPageOptions"],[3,"visibleChange","visible","header","modal"],[3,"ngSubmit","formGroup"],[1,"flex","items-center","gap-4","mb-4"],["for","roleName",1,"font-semibold","w-24"],["formControlName","roleName","pInputText","","id","roleName","autocomplete","off",1,"flex-auto"],[1,"flex","items-center","gap-4","mb-6"],["for","description",1,"font-semibold","w-24"],["formControlName","description","pInputText","","id","description","autocomplete","off",1,"flex-auto"],[1,"mb-4"],[1,"font-semibold","w-24"],["selectionMode","checkbox","styleClass","w-full md:w-[30rem]",3,"selectionChange","value","selection"],[1,"flex","justify-end","gap-2"],["severity","secondary",3,"click","label"],["type","submit",3,"label","loading"],[1,"flex","items-center","gap-2"],["icon","pi pi-plus","severity","secondary",1,"mr-2",3,"onClick","label"],["severity","secondary","icon","pi pi-trash","outlined","",3,"onClick","label","disabled"],["icon","pi pi-upload","severity","secondary",3,"label"],[1,"flex","items-center","justify-between"],[1,"m-0"],["styleClass","pi pi-search"],["pInputText","","type","text",3,"input","placeholder"],[2,"width","3rem"],["pSortableColumn","roleName"],["field","roleName"],["pSortableColumn","description"],["field","description"],[3,"value"],[1,"flex","gap-2","items-center"],["icon","pi pi-pencil","tooltipPosition","top",3,"onClick","pTooltip","rounded","outlined"]],template:function(t,i){if(t&1){let m=C();o(0,"p-toolbar",6),D(1,Pe,5,7,"ng-template",null,0,v)(3,Fe,2,3,"ng-template",null,1,v),r(),o(5,"p-table",7,2),L("selectionChange",function(d){return f(m),I(i.selectedRoles,d)||(i.selectedRoles=d),g(d)}),D(7,De,8,6,"ng-template",null,3,v)(9,Me,17,12,"ng-template",null,4,v)(11,Ve,13,9,"ng-template",null,5,v),r(),o(13,"p-dialog",8),L("visibleChange",function(d){return f(m),I(i.roleDialog,d)||(i.roleDialog=d),g(d)}),o(14,"form",9),b("ngSubmit",function(){return f(m),g(i.onSaveRole())}),o(15,"div",10)(16,"label",11),c(17),a(18,"translate"),r(),u(19,"input",12),r(),o(20,"div",13)(21,"label",14),c(22),a(23,"translate"),r(),u(24,"input",15),r(),o(25,"div",16)(26,"label",17),c(27),a(28,"translate"),r(),o(29,"p-tree",18),L("selectionChange",function(d){return f(m),I(i.selectedPerms,d)||(i.selectedPerms=d),g(d)}),r()(),o(30,"div",19)(31,"p-button",20),a(32,"translate"),b("click",function(){return f(m),g(i.roleDialog=!1)}),r(),u(33,"p-button",21),a(34,"translate"),r()()(),u(35,"p-toast")}t&2&&(l(5),p("value",i.roleList)("rows",10)("columns",i.cols)("loading",i.loading)("globalFilterFields",w(34,ye))("tableStyle",w(35,Ie)),y("selection",i.selectedRoles),p("rowHover",!0)("showCurrentPageReport",!0)("rowsPerPageOptions",w(36,Le)),l(8),k(w(37,Ne)),y("visible",i.roleDialog),p("header",i.dialogHeader)("modal",!0),l(),p("formGroup",i.roleForm),l(3),R(s(18,24,"TITLE")),l(5),R(s(23,26,"DESCRIPTION")),l(5),R(s(28,28,"PERMISSIONS")),l(2),p("value",i.permList),y("selection",i.selectedPerms),l(2),p("label",s(32,30,"CANCEL")),l(2),p("label",s(34,32,"SAVE"))("loading",i.saveLoading))},dependencies:[N,ue,se,pe,me,de,ce,Q,q,O,H,W,X,U,K,le,ne,fe,be,he,re,oe,ge,ve,Se,ie,te,ee,$,Z,Y,ae,_e,z],encapsulation:2})};var Be=[{path:"",component:P,canActivate:[we],data:{perms:["perm.access.role"]}}],F=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=x({type:n});static \u0275inj=E({imports:[M.forChild(Be),M]})};var xe=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=x({type:n});static \u0275inj=E({imports:[N,F]})};export{xe as RolesModule};
