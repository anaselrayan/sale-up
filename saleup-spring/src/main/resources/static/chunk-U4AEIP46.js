import{a as Yt,b as Gt}from"./chunk-AVFJV4JT.js";import{a as jt,b as Ht,c as Wt}from"./chunk-NCVURNQW.js";import{a as $t}from"./chunk-FXAYZTIC.js";import{a as qe}from"./chunk-VXSSJJQX.js";import{a as Ot}from"./chunk-MGHGSYG7.js";import{a as me}from"./chunk-O3SRXZ6G.js";import{a as xe}from"./chunk-P52CH6MF.js";import"./chunk-MDE73TGC.js";import{a as Ut}from"./chunk-JMAJ42AW.js";import{a as ze,b as Ye}from"./chunk-PNAF5FZM.js";import{a as le}from"./chunk-KW2DE3UV.js";import{A as ee,m as ge,n as Vt,q as Z,t as je,u as He,x as We,y as $e}from"./chunk-SMT4EN3V.js";import"./chunk-XFY4HXS5.js";import"./chunk-ETRWT4GR.js";import"./chunk-KWA6YC6W.js";import{a as Qt,b as Je,c as zt,d as Xe,e as Ie}from"./chunk-CGK77XJQ.js";import{a as he}from"./chunk-YIQD4OOL.js";import{a as se,b as Ge}from"./chunk-7SGIY5X6.js";import{a as ae}from"./chunk-JLVC7EHP.js";import{a as H}from"./chunk-G5SBXPRX.js";import{a as A}from"./chunk-I5ND5X5X.js";import{a as Ve,c as J,d as P,e as B}from"./chunk-BVAXM6NJ.js";import{a as ie,b as ne}from"./chunk-LNEBUSAV.js";import"./chunk-INLTFKLG.js";import{b as te,c as Qe}from"./chunk-L5ASE5JY.js";import{a as qt}from"./chunk-UMS3TPJ7.js";import{c as Ue}from"./chunk-WRM6PFBH.js";import{a as G,c as fe,d as X,h as _e,i as K}from"./chunk-AWHW4APH.js";import{e as Y,g as O,h as oe,m as F}from"./chunk-ATPXQBBY.js";import{Ia as Lt,La as ue,Oa as Nt,Pa as Oe,Sa as Ft,Xa as D,Ya as kt,b as ke,ob as ve,pb as M,qb as Se,rb as V,sb as L,wa as At}from"./chunk-6PJPRA3Z.js";import{$b as $,Cb as r,D as It,Db as a,Eb as _,H as Ct,Ib as T,Kb as E,Lb as u,Nc as Mt,O as bt,Oa as W,Oc as Fe,Pc as k,Rb as wt,Sb as Dt,T as ce,Ta as i,Tb as Pt,U as Ae,Ua as g,Wb as de,Xb as o,Y as Le,Yb as c,Yc as R,Zb as f,_b as Bt,ac as Q,bc as z,dc as v,eb as w,ec as re,f as ht,fb as Ne,ga as h,ha as I,hb as Rt,ia as yt,ja as Et,lb as x,nc as s,oc as p,pa as Tt,pc as N,rc as C,tb as m,wb as y}from"./chunk-JPVIOWP6.js";import"./chunk-EQDQRRRY.js";var Ke=class{customer;items;subTotal;discount;grandTotal;constructor(){this.items=[],this.subTotal=0,this.discount=0,this.grandTotal=0}empty(){this.items=[],this.subTotal=0,this.discount=0,this.grandTotal=0}},Ce=class{product;quantity;constructor(t,e){this.product=t,this.quantity=e}};var Ze=class{static playSaleEffect(){var t=new Audio("assets/sounds/sale-pulse.mp3");t.play()}};var et=class{saleId;customerId;saleItems;subTotal;grandTotal;discount},tt=class{saleItemId;saleId;productId;quantity};var be=class n{addProductSubject=new ht;addItem(t,e){this.getItem(t,e)?this.increaseQty(t,e):this.addNewItem(t,e),Ze.playSaleEffect()}addNewItem(t,e){let l=new Ce;l.product=t,l.quantity=1,t.basicDetails.quantity>0&&(e.items?.push(l),this.updateAmout(e))}increaseQty(t,e){let l=this.getItem(t,e);l&&l.quantity&&l.quantity<t.basicDetails.quantity&&(l.quantity++,this.updateAmout(e))}decreaseQty(t,e){let l=this.getItem(t,e);l&&l.quantity&&l.quantity>1&&(l.quantity--,this.updateAmout(e))}itemExists(t,e){if(e&&e.items){for(let l of e.items)if(l.product?.productId==t?.productId)return!0;return!1}return!1}removeItem(t,e){if(e&&e.items)for(let l=0;l<e.items.length;l++)e.items[l].product?.productId==t?.productId&&(e.items.splice(l,1),this.updateAmout(e))}getItem(t,e){if(e&&e.items){for(let l of e.items)if(l.product?.productId==t?.productId)return l;return null}return null}updateAmout(t){if(t&&t.items){t.subTotal=0,t.grandTotal=0;for(let e of t.items){let l=this.getItemTotal(e)||0;t.subTotal+=l}t.grandTotal=t.subTotal-t.discount}}updateDiscount(t){t.grandTotal=t.subTotal-t.discount}getItemTotal(t){return t&&t.product&&t.quantity?t.product.priceDetails.priceWithDiscount*t.quantity:null}cartToSaleRequest(t){if(t.items){let e=new et;return e.customerId=t.customer?.customerId,e.subTotal=t.subTotal,e.grandTotal=t.grandTotal,e.discount=t.discount,e.saleItems=this.cartItemsToSaleItems(t.items),e}return{}}cartItemsToSaleItems(t){let e=[];for(let l of t){let d=new tt;d.productId=l.product?.productId,d.quantity=l.quantity,e.push(d)}return e}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})};var U=class n{constructor(t){this.http=t}basUrl=Ve.apiBaseUrl+"/sale";createSale(t){return this.http.post(this.basUrl,t)}updateSale(t){return this.http.put(this.basUrl,t)}getSalesPage(t){return this.http.get(`${this.basUrl}?page=${t.page}&size=${t.size}`)}getSaleById(t){return this.http.get(`${this.basUrl}/${t}`)}getSaleReceipt(t){return this.http.get(`${this.basUrl}/receipt/${t}`,{responseType:"blob"})}deleteSale(t){return this.http.delete(`${this.basUrl}/${t}`)}previewSaleReceipt(t){this.getSaleReceipt(t.saleId).subscribe(e=>{let l=new Blob([e],{type:"application/pdf"}),d=URL.createObjectURL(l),S=window.open(d,"_blank");S&&(S.onload=()=>{S.print()})})}static \u0275fac=function(e){return new(e||n)(Le(ke))};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})};var si=()=>({minWidth:"40rem",overflow:"hidden"}),ft=()=>({width:"100%"}),pi=()=>({width:"100%",border:"1px dashed"}),mi=()=>({width:"3rem"});function ci(n,t){if(n&1&&(r(0,"div",24)(1,"p-message",25),o(2),s(3,"translate"),a()()),n&2){let e=u();i(2),Bt(" ",p(3,2,"EDIT_RECEIPT")," ",e.saleToEdit.barcode," ")}}function di(n,t){if(n&1&&(r(0,"div",26),_(1,"p-avatar",27),r(2,"div"),o(3),a(),r(4,"span",28),o(5),a()()),n&2){let e=t.$implicit;i(),m("label",e.fullName.toUpperCase()[0]),i(2),c(e.phone),i(2),f(" ",e.fullName," ")}}function ui(n,t){if(n&1){let e=T();r(0,"p-button",29),s(1,"translate"),E("onClick",function(){h(e);let d=u();return I(d.cart.empty())}),a()}n&2&&m("label",p(1,2,"EMPTY_CART"))("text",!0)}function fi(n,t){n&1&&(r(0,"div",30),o(1),s(2,"translate"),a()),n&2&&(i(),f(" ",p(2,1,"CART_EMPTY")," "))}function _i(n,t){if(n&1){let e=T();r(0,"span",41),E("click",function(){h(e);let d=u().$implicit,S=u();return I(S.increaseQty(d))}),_(1,"span",42),a()}}function vi(n,t){if(n&1){let e=T();r(0,"span",41),E("click",function(){h(e);let d=u().$implicit,S=u();return I(S.decreaseQty(d))}),_(1,"span",43),a()}}function Si(n,t){if(n&1){let e=T();r(0,"div",31),_(1,"img",32),r(2,"div",33)(3,"div",34)(4,"div",35),o(5),a(),r(6,"span",36),o(7),s(8,"sCurrency"),a()(),r(9,"div",37)(10,"p-inputnumber",38),z("ngModelChange",function(d){let S=h(e).$implicit;return Q(S.quantity,d)||(S.quantity=d),I(d)}),x(11,_i,2,0,"ng-template",null,2,C)(13,vi,2,0,"ng-template",null,3,C),a()(),r(15,"div",39),o(16),s(17,"sCurrency"),a()(),r(18,"p-button",40),E("onClick",function(){let d=h(e).$implicit,S=u();return I(S.removeItem(d))}),a()()}if(n&2){let e=t.$implicit,l=u();i(),m("src",l.getProductImageSrc(e.product),W)("alt",e.product.basicDetails.productName),i(3),m("pTooltip",e.product==null||e.product.basicDetails==null?null:e.product.basicDetails.productName),i(),f(" ",e.product==null||e.product.basicDetails==null?null:e.product.basicDetails.productName," "),i(2),c(p(8,12,e.product==null||e.product.priceDetails==null?null:e.product.priceDetails.priceWithDiscount)),i(3),$("ngModel",e.quantity),m("max",(e.product==null||e.product.basicDetails==null?null:e.product.basicDetails.quantity)||99)("showButtons",!0)("inputStyle",v(16,mi)),i(6),c(p(17,14,l.cartService.getItemTotal(e))),i(2),m("rounded",!0)("text",!0)}}function gi(n,t){if(n&1){let e=T();r(0,"p-button",46),s(1,"translate"),E("onClick",function(){h(e);let d=u(2);return I(d.editSale())}),a()}if(n&2){let e=u(2);y(v(7,ft)),m("loading",e.orderLoading)("label",p(1,5,"SAVE_CHANGES"))("disabled",!e.cart.items||!e.cart.items.length)}}function xi(n,t){if(n&1){let e=T();r(0,"p-button",46),s(1,"translate"),E("onClick",function(){h(e);let d=u(2);return I(d.submitOrder())}),a()}if(n&2){let e=u(2);y(v(7,ft)),m("loading",e.orderLoading)("label",p(1,5,"SUBMIT_ORDER"))("disabled",!e.cart.items||!e.cart.items.length)}}function hi(n,t){if(n&1&&(r(0,"div",44),x(1,gi,2,8,"p-button",45)(2,xi,2,8,"p-button",45),a()),n&2){let e=u();i(),m("ngIf",e.saleToEdit),i(),m("ngIf",!e.saleToEdit)}}function Ii(n,t){if(n&1){let e=T();r(0,"app-customer-create-dialog",47),E("visibleChange",function(d){h(e);let S=u();return I(S.toggleDialog(d))}),a()}}function Ci(n,t){if(n&1&&(r(0,"div",48),_(1,"i",49),r(2,"p"),o(3),a()()),n&2){let e=t.$implicit;i(),m("ngClass",e.icon),i(2),c(e.message)}}var it=class n{constructor(t,e,l,d,S,b,Me){this.cartService=t;this.customerService=e;this.saleService=l;this.toast=d;this.translate=S;this.route=b;this.router=Me}cart;saleToEdit;customers=[];orderLoading=!1;customerDialog=!1;success=new Tt;ngOnInit(){this.cart=new Ke,this.fetchSaleDetails(),this.subscribeForProducts()}subscribeForProducts(){this.cartService.addProductSubject.subscribe(t=>{this.cartService.addItem(t,this.cart)})}fetchSaleDetails(){let t=this.route.snapshot.paramMap.get("saleId");if(t){let e=Number.parseInt(t);e&&Number.isInteger(e)&&this.saleService.getSaleById(e).subscribe(l=>{l.success?(this.saleToEdit=l.data,this.cart.customer=this.saleToEdit.customer,this.cart.discount=this.saleToEdit.discount,this.cart.subTotal=this.saleToEdit.subTotal,this.cart.grandTotal=this.saleToEdit.grandTotal,this.cart.items=this.saleToEdit.saleItems.map(d=>new Ce(d.product,d.quantity))):this.router.navigate(["/notfound"])})}}searchCustomers(t){this.customerService.filterCustomersByPhone(t.query).subscribe(e=>this.customers=e.data)}getProductImageSrc(t){return H.getFirstImageSrc(t)}increaseQty(t){this.cartService.increaseQty(t.product,this.cart)}decreaseQty(t){this.cartService.decreaseQty(t.product,this.cart)}removeItem(t){this.cartService.removeItem(t.product,this.cart)}submitOrder(){this.orderLoading=!0,this.saleService.createSale(this.cartService.cartToSaleRequest(this.cart)).subscribe(t=>{t.success?(this.toast.showSuccess(this.translate.instant("ORDER_SAVED")),this.cart.empty(),this.success.emit(!0),this.saleService.previewSaleReceipt(t.data)):this.toast.showError(t.message),this.orderLoading=!1},t=>{this.toast.showError(t.error.message),this.orderLoading=!1})}editSale(){this.orderLoading=!0;let t=this.cartService.cartToSaleRequest(this.cart);t.saleId=this.saleToEdit.saleId,this.saleService.updateSale(t).subscribe(e=>{e.success?(this.toast.showSuccess(this.translate.instant("ORDER_SAVED")),this.cart.empty(),this.success.emit(!0),this.router.navigate(["/sales/list"]),this.saleService.previewSaleReceipt(e.data)):this.toast.showError(e.message),this.orderLoading=!1},e=>{this.toast.showError(e.error.message),this.orderLoading=!1})}updateDiscount(){this.cartService.updateDiscount(this.cart)}toggleDialog(t){this.customerDialog=t}static \u0275fac=function(e){return new(e||n)(g(be),g(Yt),g(U),g(ae),g(J),g(Y),g(O))};static \u0275cmp=w({type:n,selectors:[["app-pos-sale-details"]],outputs:{success:"success"},decls:48,vars:43,consts:[["footer",""],["message",""],["incrementbuttonicon",""],["decrementbuttonicon",""],["class","mb-4 text-center",4,"ngIf"],[1,"search-customers","mb-8"],[1,"flex","flex-col","gap-2","mb-4"],[1,"text-lg"],["optionLabel","phone",3,"ngModelChange","completeMethod","dropdown","ngModel","suggestions"],["pTemplate","item"],["icon","pi pi-plus","outlined","true",3,"onClick","label"],[1,"order-details"],[1,"mb-4","text-lg","flex","justify-between"],["severity","danger","icon","pi pi-shopping-cart","class","mr-2",3,"label","text","onClick",4,"ngIf"],["class","no-items text-center text-surface-600",4,"ngIf"],[1,"order-items","overflow-auto","flex","flex-col","gap-2","mb-6",2,"max-height","20rem"],["class","order-item flex gap-4 items-center justify-between",4,"ngFor","ngForOf"],[1,"total"],[1,"flex","justify-between"],[1,"mb-4","text-surface-400"],["id","discount","mode","currency","currency","USD","showButtons","",3,"onInput","ngModelChange","disabled","ngModel"],[1,"border-dashed"],[1,"mb-4","font-bold","text-lg"],[3,"visibleChange",4,"ngIf"],[1,"mb-4","text-center"],["severity","warn"],[1,"flex","gap-2","items-center"],["shape","circle",3,"label"],[1,"font-sm"],["severity","danger","icon","pi pi-shopping-cart",1,"mr-2",3,"onClick","label","text"],[1,"no-items","text-center","text-surface-600"],[1,"order-item","flex","gap-4","items-center","justify-between"],[1,"rounded","w-full",2,"width","4rem","height","4rem","object-fit","cover",3,"src","alt"],[1,"flex","items-center","justify-between","w-full"],[1,"flex","flex-col"],["tooltipPosition","top",1,"mb-2","text-max-lines-1",2,"width","12rem",3,"pTooltip"],[1,"text-primary"],[1,"item-actions","ml-1","mr-1"],["readonly","true","min","1","buttonLayout","horizontal","spinnerMode","horizontal",3,"ngModelChange","ngModel","max","showButtons","inputStyle"],[1,"w-3rem","text-primary",2,"min-width","3rem"],["icon","pi pi-times","severity","danger",3,"onClick","rounded","text"],[1,"w-full","h-full","flex","items-center","justify-center",3,"click"],[1,"pi","pi-plus"],[1,"pi","pi-minus"],[1,"payment","text-lg"],[3,"loading","style","label","disabled","onClick",4,"ngIf"],[3,"onClick","loading","label","disabled"],[3,"visibleChange"],[1,"flex","flex-col","items-center","w-full","gap-4","border-b","border-surface-200","dark:border-surface-700"],[1,"!text-6xl","text-primary-500",3,"ngClass"]],template:function(e,l){if(e&1){let d=T();r(0,"p-card"),x(1,ci,4,4,"div",4),r(2,"div",5)(3,"div",6)(4,"div",7),o(5),s(6,"translate"),a(),r(7,"p-autocomplete",8),z("ngModelChange",function(b){return h(d),Q(l.cart.customer,b)||(l.cart.customer=b),I(b)}),E("completeMethod",function(b){return h(d),I(l.searchCustomers(b))}),x(8,di,6,3,"ng-template",9),a()(),r(9,"p-button",10),s(10,"translate"),E("onClick",function(){return h(d),I(l.customerDialog=!0)}),a()(),r(11,"div",11)(12,"div",12)(13,"span"),o(14),s(15,"translate"),a(),x(16,ui,2,4,"p-button",13),a(),x(17,fi,3,3,"div",14),r(18,"div",15),x(19,Si,19,17,"div",16),a(),r(20,"div",17)(21,"div",18)(22,"div",19),o(23),s(24,"translate"),a(),r(25,"span"),o(26),s(27,"sCurrency"),a()(),r(28,"div",18)(29,"div",19),o(30),s(31,"translate"),a(),r(32,"p-inputnumber",20),E("onInput",function(){return h(d),I(l.updateDiscount())}),z("ngModelChange",function(b){return h(d),Q(l.cart.discount,b)||(l.cart.discount=b),I(b)}),a()(),_(33,"hr",21),r(34,"div",18)(35,"div",22),o(36),s(37,"translate"),a(),r(38,"span",7),o(39),s(40,"sCurrency"),a()()()(),x(41,hi,3,2,"ng-template",null,0,C),a(),_(43,"p-toast"),x(44,Ii,1,0,"app-customer-create-dialog",23),r(45,"p-confirmdialog"),x(46,Ci,4,2,"ng-template",null,1,C),a()}e&2&&(y(v(40,si)),i(),m("ngIf",l.saleToEdit),i(4),c(p(6,24,"CUSTOMER_DETAILS")),i(2),y(v(41,ft)),m("dropdown",!0),$("ngModel",l.cart.customer),m("suggestions",l.customers),i(2),y(v(42,pi)),m("label",p(10,26,"ADD_CUSTOMER")),i(5),c(p(15,28,"ORDER_DETAILS")),i(2),m("ngIf",l.cart.items==null?null:l.cart.items.length),i(),m("ngIf",!l.cart.items||!l.cart.items.length),i(2),m("ngForOf",l.cart.items),i(4),f(" ",p(24,30,"SUB_TOTAL")," "),i(3),c(p(27,32,l.cart.subTotal)),i(4),f(" ",p(31,34,"DISCOUNT")," "),i(2),m("disabled",!l.cart.items.length),$("ngModel",l.cart.discount),i(4),f(" ",p(37,36,"TOTAL_AMOUNT")," "),i(3),c(p(40,38,l.cart.grandTotal)),i(5),m("ngIf",l.customerDialog))},dependencies:[L,V,At,R,Mt,Fe,k,D,ue,Oe,K,X,M,ne,ie,Ht,jt,$t,Ue,te,Ut,Gt,G,A,B,P,se],styles:[".scrolling-text-wrapper[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap}.scrolling-text[_ngcontent-%COMP%]{display:inline-block;font-weight:700;animation:_ngcontent-%COMP%_scroll-text 5s linear infinite}@keyframes _ngcontent-%COMP%_scroll-text{0%{transform:translate(100%)}to{transform:translate(-100%)}}"]})};var bi=()=>["code_128","ean","upc"],yi=n=>["/products/detail",n];function Ei(n,t){if(n&1){let e=T();r(0,"div",7)(1,"p-iconfield"),_(2,"p-inputicon",8)(3,"input",9),s(4,"translate"),a(),r(5,"p-paginator",10),E("onPageChange",function(d){h(e);let S=u();return I(S.onPageChange(d))}),a()()}if(n&2){let e=u();i(3),m("formControl",e.globalSearchControl)("placeholder",p(4,8,"SEARCH_PACEHOLDER")),i(2),m("first",e.pageReq.page*e.pageReq.size)("rows",e.pageReq.size)("totalRecords",(e.pageDetails==null?null:e.pageDetails.totalElements)||0)("showCurrentPageReport",!0)("showPageLinks",!1)("showJumpToPageDropdown",!1)}}function Ti(n,t){n&1&&(r(0,"div",13),_(1,"p-skeleton",14)(2,"p-skeleton",14)(3,"p-skeleton",14)(4,"p-skeleton",14),a())}function Ri(n,t){if(n&1&&(r(0,"div",30)(1,"span",31),o(2),s(3,"sCurrency"),a()()),n&2){let e=u().$implicit;i(2),f(" ",p(3,1,e.priceDetails.priceWithDiscount)," ")}}function wi(n,t){if(n&1&&(r(0,"div",30)(1,"span",32),o(2),s(3,"sCurrency"),a(),r(4,"span",31),o(5),s(6,"sCurrency"),a()()),n&2){let e=u().$implicit;i(2),f(" ",p(3,2,e.priceDetails.sellingPrice)," "),i(3),f(" ",p(6,4,e.priceDetails.priceWithDiscount)," ")}}function Di(n,t){if(n&1){let e=T();r(0,"div",17)(1,"div",18)(2,"div",19)(3,"div",20),_(4,"img",21)(5,"p-tag",22),a()(),r(6,"div",23)(7,"div")(8,"div",24),o(9),a(),r(10,"div",25),o(11),a()(),r(12,"div",26),x(13,Ri,4,3,"div",27)(14,wi,7,6,"div",27),r(15,"div",28)(16,"button",29),s(17,"translate"),E("click",function(){let d=h(e).$implicit,S=u(3);return I(S.addProductToCart(d))}),a()()()()()()}if(n&2){let e=t.$implicit,l=u(3);i(4),m("src",l.getProductImageSrc(e),W)("alt",e.basicDetails==null?null:e.basicDetails.productName),i(),m("value","QTY: "+e.basicDetails.quantity)("severity",l.getQuantitySeverity(e)),i(4),f(" ",e.basicDetails==null||e.basicDetails.productCategory==null?null:e.basicDetails.productCategory.name," "),i(),m("routerLink",re(13,yi,e.productId))("pTooltip",e.basicDetails==null?null:e.basicDetails.productName),i(),f(" ",e.basicDetails.productName," "),i(2),m("ngIf",e.priceDetails.sellingPrice==e.priceDetails.priceWithDiscount),i(),m("ngIf",e.priceDetails.sellingPrice!=e.priceDetails.priceWithDiscount),i(2),m("label",p(17,11,"ADD_TO_CART"))}}function Pi(n,t){if(n&1&&(r(0,"div",15),x(1,Di,18,15,"div",16),a()),n&2){let e=u().$implicit;i(),m("ngForOf",e)}}function Bi(n,t){if(n&1&&x(0,Ti,5,0,"div",11)(1,Pi,2,1,"div",12),n&2){let e=u();m("ngIf",e.loading),i(),m("ngIf",!e.loading)}}var Pe=class n{constructor(t,e,l,d,S){this.productService=t;this.cartService=e;this.lasyoutService=l;this.translate=d;this.toast=S}globalSearchControl=new Nt("");pageReq=new me(0,8);pageDetails;products=[];loading=!1;searching=!1;barcodeScanner;ngOnInit(){this.subscribeForGlobalSearch(),this.getProducts(),this.hideSideBar()}hideSideBar(){this.lasyoutService.isSidebarActive()||this.lasyoutService.onMenuToggle()}ngAfterViewInit(){}onValueChanges(t){if(this.searching)return;this.searching=!0;let e=t.codeResult.code.trim();this.productService.getProductByBarcode(e).subscribe(l=>{l.success?this.cartService.addProductSubject.next(l.data):(this.toast.showError(this.translate.instant("PRODUCT_NOT_FOUND")),this.searching=!1)})}subscribeForGlobalSearch(){this.pageReq=new me(0,8),this.loading=!0,this.globalSearchControl.valueChanges.pipe(It(300),bt(t=>this.productService.searchByKeyword(t||"",this.pageReq).pipe(Ct(()=>this.loading=!1)))).subscribe(t=>{t.success&&(this.products=t.data.content,this.pageDetails=t.data.page),this.loading=!1})}getProducts(){this.loading=!0,this.productService.getProductsPage(this.pageReq).subscribe(t=>{t.success&&(this.products=t.data.content,this.pageDetails=t.data.page),this.loading=!1})}getQuantitySeverity(t){return H.getQuantitySeverity(t)}getProductImageSrc(t){return H.getFirstImageSrc(t)}addProductToCart(t){this.cartService.addProductSubject.next(t)}onPageChange(t){this.pageReq.page=t.page,this.pageReq.size=t.rows,this.getProducts()}orderSuccess(t){this.getProducts()}static \u0275fac=function(e){return new(e||n)(g(Qt),g(be),g(Ot),g(J),g(ae))};static \u0275cmp=w({type:n,selectors:[["app-pos"]],viewQuery:function(e,l){if(e&1&&wt(Je,5),e&2){let d;Dt(d=Pt())&&(l.barcodeScanner=d.first)}},decls:11,vars:3,consts:[["dv",""],["header",""],["grid",""],[1,"flex","gap-2","h-full","w-full"],[3,"success"],["layout","grid",3,"value"],[3,"valueChanges","type"],[1,"flex","items-center","justify-between"],["styleClass","pi pi-barcode"],["pInputText","","type","text",1,"w-80",3,"formControl","placeholder"],["currentPageReportTemplate","Showing {first} to {last} of {totalRecords}",3,"onPageChange","first","rows","totalRecords","showCurrentPageReport","showPageLinks","showJumpToPageDropdown"],["class","loading flex flex-wrap gap-2 mb-4 mt-4",4,"ngIf"],["class","grid grid-cols-12 gap-4",4,"ngIf"],[1,"loading","flex","flex-wrap","gap-2","mb-4","mt-4"],["size","10rem"],[1,"grid","grid-cols-12","gap-4"],["class","col-span-6 sm:col-span-3 md:col-span-3 xl:col-span-3 p-2",4,"ngFor","ngForOf"],[1,"col-span-6","sm:col-span-3","md:col-span-3","xl:col-span-3","p-2"],[1,"p-3","border","border-surface-200","dark:border-surface-700","bg-surface-0","dark:bg-surface-900","rounded","flex","flex-col"],[1,"bg-surface-50","flex","justify-center","rounded","p-1"],[1,"relative","mx-auto"],[1,"rounded","w-full",2,"width","20rem","height","8rem","object-fit","cover",3,"src","alt"],["styleClass","dark:!bg-surface-900",1,"absolute","absolute","top-0","left-0",3,"value","severity"],[1,"pt-4"],[1,"text-right","text-red-300"],["tooltipPosition","top",1,"mt-1","cursor-pointer","text-overflow-ellipsis","overflow-hidden","text-max-lines-2",3,"routerLink","pTooltip"],[1,"flex","flex-col","gap-6","mt-6"],["class","flex gap-3",4,"ngIf"],[1,"flex","gap-2"],["pButton","","icon","pi pi-shopping-cart","variant","text","severity","secondary",1,"flex-auto",3,"click","label"],[1,"flex","gap-3"],[1,"font-semibold","text-primary"],[1,"text-sm","text-surface-400","line-through"]],template:function(e,l){if(e&1){let d=T();r(0,"div",3)(1,"app-pos-sale-details",4),E("success",function(b){return h(d),I(l.orderSuccess(b))}),a(),r(2,"p-card")(3,"p-dataview",5,0),x(5,Ei,6,10,"ng-template",null,1,C)(7,Bi,2,2,"ng-template",null,2,C),a()()(),r(9,"barcode-scanner-livestream",6),E("valueChanges",function(b){return h(d),I(l.onValueChanges(b))}),a(),_(10,"p-toast")}e&2&&(i(3),m("value",l.products),i(6),m("type",v(2,bi)))},dependencies:[Wt,qt,L,Se,R,Fe,k,D,Lt,ue,kt,Ft,K,_e,X,fe,M,ve,ne,ie,it,zt,Je,Vt,ge,G,A,le,te,F,oe,B,P],encapsulation:2})};var j=class n{transform(t,e="medium"){let d=this.getLang()==="ar"?["ar","ar-u-nu-latn"]:["en"],S={};switch(e){case"short":S={year:"numeric",month:"short",day:"numeric"};break;case"medium":S={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0};break;case"long":S={weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0};break}return new Intl.DateTimeFormat(d,S).format(new Date(t))}getLang(){let t=sessionStorage.getItem("app.state");if(t)return JSON.parse(t).defaultLanguage||"en"}static \u0275fac=function(e){return new(e||n)};static \u0275pipe=Rt({name:"dateFt",type:n,pure:!0})};var Ni=()=>["barcode","customer.fullName","createdBy"],Fi=()=>({"min-width":"75rem"}),ki=()=>[10,20,30],Oi=()=>({width:"450px"}),Vi=n=>["/sales/detail",n],qi=()=>["/sales/sale-return/list"],Ui=n=>({saleId:n});function ji(n,t){if(n&1){let e=T();r(0,"div",10),_(1,"p-button",11),s(2,"translate"),r(3,"p-button",12),s(4,"translate"),E("onClick",function(){h(e);let d=u();return I(d.deleteSelectedSales())}),a()()}if(n&2){let e=u();i(),m("label",p(2,3,"ADD")),i(2),m("label",p(4,5,"DELETE"))("disabled",!e.selectedSales||!e.selectedSales.length)}}function Hi(n,t){n&1&&(_(0,"p-button",13),s(1,"translate")),n&2&&m("label",p(1,1,"EXPORT"))}function Wi(n,t){if(n&1){let e=T();r(0,"div",14)(1,"h5",15),o(2),s(3,"translate"),a(),r(4,"p-iconfield"),_(5,"p-inputicon",16),r(6,"input",17),s(7,"translate"),E("input",function(d){h(e);let S=u(),b=de(6);return I(S.onGlobalFilter(b,d))}),a()()()}n&2&&(i(2),c(p(3,2,"SALE_HISTORY")),i(4),m("placeholder",p(7,4,"SEARCH_PACEHOLDER")))}function $i(n,t){n&1&&(r(0,"tr")(1,"th",18),_(2,"p-tableHeaderCheckbox"),a(),r(3,"th"),o(4),s(5,"translate"),a(),r(6,"th",19),o(7),s(8,"translate"),_(9,"p-sortIcon",20),a(),r(10,"th",21),o(11),s(12,"translate"),_(13,"p-sortIcon",22),a(),r(14,"th",23),o(15),s(16,"translate"),_(17,"p-sortIcon",24),a(),r(18,"th"),o(19),s(20,"translate"),a(),r(21,"th",25),o(22),s(23,"translate"),_(24,"p-sortIcon",26),a(),r(25,"th"),o(26),s(27,"translate"),a()()),n&2&&(i(4),f(" ",p(5,7,"BARCODE")," "),i(3),f(" ",p(8,9,"DATE")," "),i(4),f(" ",p(12,11,"CUSTOMER")," "),i(4),f(" ",p(16,13,"GRAND_TOTAL")," "),i(4),f(" ",p(20,15,"SALE_RETURN_STATUS")," "),i(3),f(" ",p(23,17,"SOLD_BY")," "),i(4),c(p(27,19,"OPTIONS")))}function Qi(n,t){n&1&&(r(0,"div",35),o(1),s(2,"translate"),a()),n&2&&(i(),f(" ",p(2,1,"NOT_REGISTERED_CUSTOMER")," "))}function zi(n,t){n&1&&(r(0,"div",36),_(1,"i",37),r(2,"div",38),o(3),s(4,"translate"),a()()),n&2&&(i(3),c(p(4,1,"SALE_TOTALLY_RETURNED")))}function Yi(n,t){n&1&&(r(0,"div",36),_(1,"i",37),r(2,"div",39),o(3),s(4,"translate"),a()()),n&2&&(i(3),c(p(4,1,"SALE_PARTIALLY_RETURNED")))}function Gi(n,t){n&1&&(r(0,"div",40)(1,"div",41),o(2),s(3,"translate"),a()()),n&2&&(i(2),c(p(3,1,"SALE_HAS_NO_RETURNS")))}function Ji(n,t){if(n&1&&(r(0,"a",42),o(1),s(2,"translate"),a()),n&2){let e=u().$implicit;m("routerLink",v(5,qi))("queryParams",re(6,Ui,e.saleId)),i(),c(p(2,3,"SHOW_SALE_RETURNS"))}}function Xi(n,t){if(n&1){let e=T();r(0,"tr")(1,"td"),_(2,"p-tableCheckbox",27),a(),r(3,"td")(4,"a",28),o(5),a()(),r(6,"td"),o(7),s(8,"dateFt"),a(),r(9,"td"),o(10),x(11,Qi,3,3,"div",29),a(),r(12,"td"),o(13),s(14,"sCurrency"),a(),r(15,"td"),x(16,zi,5,3,"div",30)(17,Yi,5,3,"div",30)(18,Gi,4,3,"div",31)(19,Ji,3,8,"a",32),a(),r(20,"td"),o(21),a(),r(22,"td"),_(23,"p-menu",33,6),r(25,"button",34),E("click",function(d){let S=h(e).$implicit,b=de(24);return u().getMenuItems(S),I(b.toggle(d))}),a()()()}if(n&2){let e=t.$implicit,l=u();i(2),m("value",e),i(2),m("routerLink",re(19,Vi,e.saleId)),i(),c(e.barcode),i(2),f(" ",N(8,14,e.createdAt,"long")," "),i(3),f(" ",e.customer==null?null:e.customer.fullName," "),i(),m("ngIf",!e.customer),i(2),f(" ",p(14,17,e.grandTotal)," "),i(3),m("ngIf",e.totallyReturned),i(),m("ngIf",e.partiallyReturned),i(),m("ngIf",!e.partiallyReturned&&!e.totallyReturned),i(),m("ngIf",e.totallyReturned||e.partiallyReturned),i(2),f(" ",e.createdBy," "),i(2),m("popup",!0)("model",l.menuItems)}}var rt=class n{constructor(t,e,l,d,S){this.saleService=t;this.translate=e;this.toast=l;this.confirmService=d;this.router=S}loading=!1;pageReq=new me(0,10);pageDetails;salesList=[];sale;selectedSales;cols;mode;menuItems=[];ngOnInit(){this.getSalesPage()}getSalesPage(){this.loading=!0,this.saleService.getSalesPage(this.pageReq).subscribe(t=>{t.success&&(this.salesList=t.data.content,this.pageDetails=t.data.page,this.loading=!1)})}onPageChange(t){this.pageReq.page=t.page,this.pageReq.size=t.rows,this.getSalesPage()}onGlobalFilter(t,e){t.filterGlobal(e.target.value,"contains")}getMenuItems(t){this.menuItems=[{label:this.translate.instant("SHOW_DETAILS"),icon:"pi pi-eye",command:()=>{this.saleDetails(t)}},{label:this.translate.instant("PRINT_RECEIPT"),icon:"pi pi-print",command:()=>{this.saleService.previewSaleReceipt(t)}},{label:this.translate.instant("EDIT"),icon:"pi pi-pen-to-square",disabled:t.partiallyReturned||t.totallyReturned,command:()=>{this.editSale(t)}},{label:this.translate.instant("RETURN_SALE"),icon:"pi pi-arrow-right-arrow-left",disabled:t.totallyReturned,command:()=>{this.saleReturn(t)}},{label:this.translate.instant("DELETE"),icon:"pi pi-trash",command:()=>{this.deleteSale(t)}}]}editSale(t){this.router.navigate(["sales/edit",t.saleId])}deleteSale(t){let e=this.translate.instant("DELETE_ALERT",{name:t.barcode});this.confirmService.dialogAlert(e,()=>{this.saleService.deleteSale(t.saleId).subscribe(l=>{l.success?(this.toast.showSuccess(this.translate.instant("SAVE_SUCCESS")),this.getSalesPage()):this.toast.showError(l.message)})})}deleteSelectedSales(){}downloadReceipt(t){this.saleService.previewSaleReceipt(t)}saleDetails(t){this.router.navigate(["sales/detail",t.saleId])}saleReturn(t){this.router.navigate(["sales/sale-return/create",t.saleId])}static \u0275fac=function(e){return new(e||n)(g(U),g(J),g(ae),g(he),g(O))};static \u0275cmp=w({type:n,selectors:[["app-sales-list"]],decls:16,vars:20,consts:[["start",""],["end",""],["dt",""],["caption",""],["header",""],["body",""],["menu",""],["styleClass","mb-6"],["dataKey","saleId",3,"selectionChange","value","rows","columns","loading","globalFilterFields","tableStyle","selection","rowHover"],["currentPageReportTemplate","Showing {first} to {last} of {totalRecords}",3,"onPageChange","first","rows","totalRecords","rowsPerPageOptions","showCurrentPageReport","showJumpToPageDropdown"],[1,"flex","items-center","gap-2"],["icon","pi pi-plus","severity","secondary",1,"mr-2",3,"label"],["severity","secondary","icon","pi pi-trash","outlined","",3,"onClick","label","disabled"],["icon","pi pi-upload","severity","secondary",3,"label"],[1,"flex","items-center","justify-between"],[1,"m-0"],["styleClass","pi pi-search"],["pInputText","","type","text",3,"input","placeholder"],[2,"width","3rem"],["pSortableColumn","createdAt"],["field","createdAt"],["pSortableColumn","customer"],["field","customer"],["pSortableColumn","grandTotal"],["field","grandTotal"],["pSortableColumn","createdBy"],["field","createdBy"],[3,"value"],[1,"text-primary",3,"routerLink"],["class","text-muted-color",4,"ngIf"],["class","flex gap-2 mb-2",4,"ngIf"],["class","flex gap-2",4,"ngIf"],["class","text-muted-color dark:text-surface-400 hover:underline",3,"routerLink","queryParams",4,"ngIf"],["appendTo","body",3,"popup","model"],["pButton","","icon","pi pi-ellipsis-v",1,"p-button-text",3,"click"],[1,"text-muted-color"],[1,"flex","gap-2","mb-2"],[1,"pi","pi-arrow-right-arrow-left","text-muted-color"],[1,"text-red-500"],[1,"text-orange-500"],[1,"flex","gap-2"],[1,"text-blue-500","dark:text-blue-300"],[1,"text-muted-color","dark:text-surface-400","hover:underline",3,"routerLink","queryParams"]],template:function(e,l){if(e&1){let d=T();r(0,"p-toolbar",7),x(1,ji,5,7,"ng-template",null,0,C)(3,Hi,2,3,"ng-template",null,1,C),a(),r(5,"p-table",8,2),z("selectionChange",function(b){return h(d),Q(l.selectedSales,b)||(l.selectedSales=b),I(b)}),x(7,Wi,8,6,"ng-template",null,3,C)(9,$i,28,21,"ng-template",null,4,C)(11,Xi,26,21,"ng-template",null,5,C),a(),r(13,"p-paginator",9),E("onPageChange",function(b){return h(d),I(l.onPageChange(b))}),a(),_(14,"p-confirmdialog")(15,"p-toast")}e&2&&(i(5),m("value",l.salesList)("rows",10)("columns",l.cols)("loading",l.loading)("globalFilterFields",v(16,Ni))("tableStyle",v(17,Fi)),$("selection",l.selectedSales),m("rowHover",!0),i(8),m("first",l.pageReq.page*l.pageReq.size)("rows",l.pageReq.size)("totalRecords",(l.pageDetails==null?null:l.pageDetails.totalElements)||0)("rowsPerPageOptions",v(18,ki))("showCurrentPageReport",!0)("showJumpToPageDropdown",!1),i(),y(v(19,Oi)))},dependencies:[R,k,ee,Z,je,He,We,$e,D,L,Se,V,Qe,te,M,ve,Ye,ze,Ge,se,B,P,fe,_e,qe,ge,A,F,oe,j],encapsulation:2})};var ei=()=>({"min-width":"50rem"}),Zi=()=>[1],en=()=>["/sales/sale-return/list"],tn=n=>({saleId:n}),nn=()=>({width:"30%"}),an=()=>({width:"20%"}),ti=()=>({width:"25%"}),_t=()=>({width:"50%"});function rn(n,t){n&1&&(r(0,"div",4),_(1,"p-skeleton",5)(2,"p-skeleton",6)(3,"p-skeleton",7)(4,"p-skeleton",8)(5,"p-skeleton",9),a())}function on(n,t){n&1&&(r(0,"div",31),_(1,"i",32),r(2,"div",33),o(3),s(4,"translate"),a()()),n&2&&(i(3),c(p(4,1,"SALE_TOTALLY_RETURNED")))}function ln(n,t){n&1&&(r(0,"div",31),_(1,"i",32),r(2,"div",34),o(3),s(4,"translate"),a()()),n&2&&(i(3),c(p(4,1,"SALE_PARTIALLY_RETURNED")))}function sn(n,t){n&1&&(r(0,"div",35)(1,"div",36),o(2),s(3,"translate"),a()()),n&2&&(i(2),c(p(3,1,"SALE_HAS_NO_RETURNS")))}function pn(n,t){if(n&1&&(r(0,"a",37),o(1),s(2,"translate"),a()),n&2){let e=u(2);m("routerLink",v(5,en))("queryParams",re(6,tn,e.sale.saleId)),i(),c(p(2,3,"SHOW_SALE_RETURNS"))}}function mn(n,t){n&1&&(r(0,"div",38)(1,"span"),o(2),s(3,"translate"),a(),o(4),s(5,"translate"),a()),n&2&&(i(2),c(p(3,2,"NAME")),i(2),f(": ",p(5,4,"NOT_REGISTERED_CUSTOMER")," "))}function cn(n,t){if(n&1&&(r(0,"div",38)(1,"span"),o(2),s(3,"translate"),a(),o(4),a()),n&2){let e=u(2);i(2),c(p(3,2,"NAME")),i(2),f(": ",e.sale.customer.fullName," ")}}function dn(n,t){if(n&1&&(r(0,"div",38)(1,"span"),o(2),s(3,"translate"),a(),o(4,": "),r(5,"span",13),o(6),a()()),n&2){let e=u(2);i(2),c(p(3,2,"PHONE")),i(4),c(e.sale.customer.phone)}}function un(n,t){if(n&1&&(r(0,"div",38)(1,"span"),o(2),s(3,"translate"),a(),o(4),a()),n&2){let e=u(2);i(2),c(p(3,2,"COUNTRY")),i(2),f(": ",e.sale.customer.country," ")}}function fn(n,t){if(n&1&&(r(0,"div",38)(1,"span"),o(2),s(3,"translate"),a(),o(4),a()),n&2){let e=u(2);i(2),c(p(3,2,"ADDRESS")),i(2),f(": ",e.sale.customer.address," ")}}function _n(n,t){if(n&1&&(r(0,"div",38)(1,"span"),o(2),s(3,"translate"),a(),o(4),a()),n&2){let e=u(2);i(2),c(p(3,2,"EMAIL")),i(2),f(": ",e.sale.customer.email," ")}}function vn(n,t){n&1&&(r(0,"tr")(1,"th"),o(2),s(3,"translate"),a(),r(4,"th"),o(5),s(6,"translate"),a(),r(7,"th"),o(8),s(9,"translate"),a(),r(10,"th"),o(11),s(12,"translate"),a()()),n&2&&(i(),y(v(20,nn)),i(),c(p(3,12,"PRODUCT")),i(2),y(v(21,an)),i(),c(p(6,14,"UNIT_PRICE")),i(2),y(v(22,ti)),i(),c(p(9,16,"QUANTITY")),i(2),y(v(23,ti)),i(),c(p(12,18,"SUB_TOTAL")))}function Sn(n,t){if(n&1&&(r(0,"tr")(1,"td",39),_(2,"img",40),r(3,"span"),o(4),s(5,"substring"),a()(),r(6,"td"),o(7),s(8,"sCurrency"),a(),r(9,"td"),o(10),a(),r(11,"td"),o(12),s(13,"sCurrency"),a()()),n&2){let e=t.$implicit,l=u(2);i(2),m("src",l.getProductImageSrc(e.product),W)("alt",e.product.basicDetails==null?null:e.product.basicDetails.productName),i(2),c(N(5,6,e.product.basicDetails.productName,"medium")),i(3),c(p(8,9,e.unitPrice)),i(3),c(e.quantity),i(2),c(p(13,11,e.subTotal))}}function gn(n,t){n&1&&_(0,"tr")}function xn(n,t){if(n&1&&(r(0,"tr")(1,"td"),o(2),s(3,"translate"),a(),r(4,"td"),o(5),s(6,"sCurrency"),a()(),r(7,"tr")(8,"td"),o(9),s(10,"translate"),a(),r(11,"td"),o(12),s(13,"sCurrency"),a()(),r(14,"tr")(15,"td"),o(16),s(17,"translate"),a(),r(18,"td",13),o(19),s(20,"sCurrency"),a()()),n&2){let e=u(2);i(2),c(p(3,12,"SUB_TOTAL")),i(2),y(v(24,_t)),i(),c(p(6,14,e.sale.subTotal)),i(4),c(p(10,16,"DISCOUNT")),i(2),y(v(25,_t)),i(),c(p(13,18,e.sale.discount)),i(4),c(p(17,20,"GRAND_TOTAL")),i(2),y(v(26,_t)),i(),c(p(20,22,e.sale.grandTotal))}}function hn(n,t){if(n&1){let e=T();r(0,"div",10)(1,"div",11)(2,"div",12)(3,"span"),o(4),s(5,"translate"),a(),o(6,": "),r(7,"span",13),o(8),a()(),r(9,"div",14)(10,"p-button",15),s(11,"translate"),E("onClick",function(){h(e);let d=u();return I(d.printReceipt())}),a(),r(12,"p-button",16),s(13,"translate"),E("onClick",function(){h(e);let d=u();return I(d.editReceipt())}),a()()(),r(14,"div",17)(15,"span",18),o(16),s(17,"translate"),a(),r(18,"span"),o(19),s(20,"dateFt"),a()(),r(21,"div",17),x(22,on,5,3,"div",19)(23,ln,5,3,"div",19)(24,sn,4,3,"div",20)(25,pn,3,8,"a",21),a(),r(26,"div",22)(27,"div",23),o(28),s(29,"translate"),a(),r(30,"div",24),x(31,mn,6,6,"div",25)(32,cn,5,4,"div",25)(33,dn,7,4,"div",25)(34,un,5,4,"div",25)(35,fn,5,4,"div",25)(36,_n,5,4,"div",25),a()(),r(37,"div",26)(38,"div",23),o(39),s(40,"translate"),a(),r(41,"p-table",27),x(42,vn,13,24,"ng-template",null,0,C)(44,Sn,14,13,"ng-template",null,1,C),a(),r(46,"div",28)(47,"p-table",27),x(48,gn,1,0,"ng-template",null,0,C)(50,xn,21,27,"ng-template",null,1,C),a()()(),r(52,"div",17)(53,"span",18),o(54),s(55,"translate"),a(),r(56,"span"),o(57),a()(),r(58,"div",29),_(59,"ngx-barcode6",30),a()()}if(n&2){let e=u();i(4),c(p(5,32,"SALE_DETAILS")),i(4),c(" "+e.sale.barcode+" "),i(2),m("pTooltip",p(11,34,"PRINT_RECEIPT"))("rounded",!0)("text",!0),i(2),m("pTooltip",p(13,36,"EDIT_RECEIPT"))("rounded",!0)("text",!0),i(4),c(p(17,38,"TIMESTAMP")+": "),i(3),c(N(20,40,e.sale.createdAt,"long")),i(3),m("ngIf",e.sale.totallyReturned),i(),m("ngIf",e.sale.partiallyReturned),i(),m("ngIf",!e.sale.partiallyReturned&&!e.sale.totallyReturned),i(),m("ngIf",e.sale.totallyReturned||e.sale.partiallyReturned),i(3),f(" ",p(29,43,"CUSTOMER_DETAILS")," "),i(3),m("ngIf",!e.sale.customer),i(),m("ngIf",e.sale.customer),i(),m("ngIf",e.sale.customer),i(),m("ngIf",e.sale.customer&&e.sale.customer.country),i(),m("ngIf",e.sale.customer&&e.sale.customer.address),i(),m("ngIf",e.sale.customer&&e.sale.customer.email),i(3),f(" ",p(40,45,"ORDER_DETAILS")," "),i(2),m("value",e.sale.saleItems)("tableStyle",v(49,ei)),i(6),m("value",v(50,Zi))("tableStyle",v(51,ei)),i(7),c(p(55,47,"SOLD_BY")+": "),i(3),c(e.sale.createdBy),i(2),m("bc-width",3)("bc-format","CODE128")("bc-value",e.sale.barcode)("bc-display-value",!0)}}var lt=class n{constructor(t,e,l){this.saleService=t;this.route=e;this.router=l}sale;loading=!1;ngOnInit(){this.fetchSaleDetails()}fetchSaleDetails(){this.loading=!0;let t=this.route.snapshot.paramMap.get("saleId");if(t){let e=Number.parseInt(t);e&&Number.isInteger(e)&&this.saleService.getSaleById(e).subscribe(l=>{l.success?this.sale=l.data:this.router.navigate(["/notfound"]),this.loading=!1})}}printReceipt(){this.saleService.previewSaleReceipt(this.sale)}editReceipt(){this.router.navigate(["/sales/edit",this.sale.saleId])}getProductImageSrc(t){return H.getFirstImageSrc(t)}static \u0275fac=function(e){return new(e||n)(g(U),g(Y),g(O))};static \u0275cmp=w({type:n,selectors:[["app-sale-details"]],decls:3,vars:2,consts:[["header",""],["body",""],["class","loading",4,"ngIf"],["class","details",4,"ngIf"],[1,"loading"],["styleClass","mb-2"],["width","10rem","styleClass","mb-2"],["width","5rem","styleClass","mb-2"],["height","2rem","styleClass","mb-2"],["width","10rem","height","4rem"],[1,"details"],[1,"font-bold","text-lg","mb-4","flex","justify-between"],[1,"header"],[1,"text-primary"],[1,"flex","items-center","gap-2"],["tooltipPosition","top","icon","pi pi-print","severity","success",3,"onClick","pTooltip","rounded","text"],["tooltipPosition","top","icon","pi pi-pen-to-square","severity","warn",3,"onClick","pTooltip","rounded","text"],[1,"mb-4"],[1,"font-md","text-muted-color"],["class","flex gap-2 mb-2",4,"ngIf"],["class","flex gap-2",4,"ngIf"],["class"," hover:underline",3,"routerLink","queryParams",4,"ngIf"],[1,"sale-customer","mb-4"],[1,"font-md","mb-2","text-muted-color"],[1,"ml-2","text-sm"],["class","mb-1",4,"ngIf"],[1,"order-summary","mb-4"],[3,"value","tableStyle"],[1,"mt-6"],[1,"flex","justify-center","w-full"],[3,"bc-width","bc-format","bc-value","bc-display-value"],[1,"flex","gap-2","mb-2"],[1,"pi","pi-arrow-right-arrow-left","text-muted-color"],[1,"text-red-500"],[1,"text-orange-500"],[1,"flex","gap-2"],[1,"text-blue-500","dark:text-blue-300"],[1,"hover:underline",3,"routerLink","queryParams"],[1,"mb-1"],[1,"dark:text-primary-200","flex","gap-2","items-center"],[1,"rounded","w-full",2,"width","3rem","height","3rem","object-fit","cover",3,"src","alt"]],template:function(e,l){e&1&&(r(0,"p-card"),x(1,rn,6,0,"div",2)(2,hn,60,52,"div",3),a()),e&2&&(i(),m("ngIf",l.loading),i(),m("ngIf",!l.loading))},dependencies:[L,V,R,k,D,K,X,M,ne,ie,A,Ie,Xe,B,P,ee,Z,le,G,xe,j,F,oe],encapsulation:2})};var pe=class n{constructor(t){this.http=t}baseUrl=Ve.apiBaseUrl+"/sale-return";createSaleReturn(t){return this.http.post(this.baseUrl,t)}getSaleReturnsPage(t){return this.http.get(`${this.baseUrl}?page=${t.page}&size=${t.size}`)}getSaleReturnById(t){return this.http.get(`${this.baseUrl}/${t}`)}getSaleReturnsBySaleId(t,e){return this.http.get(`${this.baseUrl}/sale/${t}?page=${e.page}&size=${e.size}`)}deleteSaleReturn(t){return this.http.delete(`${this.baseUrl}/${t}`)}static \u0275fac=function(e){return new(e||n)(Le(ke))};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})};var In=()=>["barcode","customer.fullName","createdBy"],Cn=()=>({"min-width":"75rem"}),bn=()=>[10,20,30],yn=()=>({width:"450px"});function En(n,t){if(n&1&&(r(0,"div",10),_(1,"p-button",11),s(2,"translate"),_(3,"p-button",12),s(4,"translate"),a()),n&2){let e=u();i(),m("label",p(2,3,"ADD")),i(2),m("label",p(4,5,"DELETE"))("disabled",!e.selectedSales||!e.selectedSales.length)}}function Tn(n,t){n&1&&(_(0,"p-button",13),s(1,"translate")),n&2&&m("label",p(1,1,"EXPORT"))}function Rn(n,t){if(n&1){let e=T();r(0,"div",14)(1,"h5",15),o(2),a(),r(3,"p-iconfield"),_(4,"p-inputicon",16),r(5,"input",17),s(6,"translate"),E("input",function(d){h(e);let S=u(),b=de(6);return I(S.onGlobalFilter(b,d))}),a()()()}if(n&2){let e=u();i(2),c(e.tableHeader),i(3),m("placeholder",p(6,2,"SEARCH_PACEHOLDER"))}}function wn(n,t){n&1&&(r(0,"tr")(1,"th",18),_(2,"p-tableHeaderCheckbox"),a(),r(3,"th"),o(4),s(5,"translate"),a(),r(6,"th",19),o(7),s(8,"translate"),_(9,"p-sortIcon",20),a(),r(10,"th",21),o(11),s(12,"translate"),_(13,"p-sortIcon",22),a(),r(14,"th",23),o(15),s(16,"translate"),_(17,"p-sortIcon",24),a(),r(18,"th",25),o(19),s(20,"translate"),_(21,"p-sortIcon",26),a(),r(22,"th",27),o(23),s(24,"translate"),_(25,"p-sortIcon",28),a(),r(26,"th",29),o(27),s(28,"translate"),_(29,"p-sortIcon",30),a(),r(30,"th",31),o(31),s(32,"translate"),_(33,"p-sortIcon",32),a(),r(34,"th"),o(35),s(36,"translate"),a()()),n&2&&(i(4),f(" ",p(5,9,"BARCODE")," "),i(3),f(" ",p(8,11,"DATE")," "),i(4),f(" ",p(12,13,"CUSTOMER")," "),i(4),f(" ",p(16,15,"SUB_TOTAL")," "),i(4),f(" ",p(20,17,"EXTRA_FEES")," "),i(4),f(" ",p(24,19,"TOTAL_REFUND")," "),i(4),f(" ",p(28,21,"CREATED_BY")," "),i(4),f(" ",p(32,23,"SALE")," "),i(4),c(p(36,25,"OPTIONS")))}function Dn(n,t){if(n&1){let e=T();r(0,"tr")(1,"td"),_(2,"p-tableCheckbox",33),a(),r(3,"td")(4,"a",34),E("click",function(){let d=h(e).$implicit,S=u();return I(S.showDetails(d))}),o(5),a()(),r(6,"td"),o(7),s(8,"dateFt"),a(),r(9,"td"),o(10),a(),r(11,"td"),o(12),s(13,"sCurrency"),a(),r(14,"td"),o(15),s(16,"sCurrency"),a(),r(17,"td",35),o(18),s(19,"sCurrency"),a(),r(20,"td"),o(21),a(),r(22,"td",36),o(23),a(),r(24,"td"),_(25,"p-menu",37,6),r(27,"button",38),E("click",function(d){let S=h(e).$implicit,b=de(26);return u().getMenuItems(S),I(b.toggle(d))}),a()()()}if(n&2){let e=t.$implicit,l=u();i(2),m("value",e),i(3),c(e.barcode),i(2),f(" ",N(8,11,e.returnDate,"long")," "),i(3),f(" ",e.sale==null||e.sale.customer==null?null:e.sale.customer.fullName," "),i(2),f(" ",p(13,14,e.subTotal)," "),i(3),f(" ",p(16,16,e.feesAmount)," "),i(3),f(" ",p(19,18,e.totalAmount)," "),i(3),f(" ",e.returnedBy," "),i(2),f(" ",e.sale.barcode," "),i(2),m("popup",!0)("model",l.menuItems)}}var Be=class n{constructor(t,e,l,d,S,b,Me){this.saleReturnService=t;this.saleService=e;this.translate=l;this.confirmService=d;this.toast=S;this.route=b;this.router=Me}loading=!1;pageReq=new me(0,10);pageDetails;returnList=[];sale;selectedSales;cols;tableHeader="";mode;menuItems=[];ngOnInit(){this.fetchSaleDetails(),this.tableHeader=this.translate.instant("SALE_RETURN_LIST")}getSaleReturnsPage(){this.loading=!0,this.sale&&this.sale.saleId?this.saleReturnService.getSaleReturnsBySaleId(this.sale.saleId,this.pageReq).subscribe(t=>{t.success&&(this.returnList=t.data.content,this.pageDetails=t.data.page,this.loading=!1)}):this.saleReturnService.getSaleReturnsPage(this.pageReq).subscribe(t=>{t.success&&(this.returnList=t.data.content,this.pageDetails=t.data.page,this.loading=!1)})}onPageChange(t){this.pageReq.page=t.page,this.pageReq.size=t.rows,this.getSaleReturnsPage()}onGlobalFilter(t,e){t.filterGlobal(e.target.value,"contains")}getMenuItems(t){this.menuItems=[{label:this.translate.instant("SHOW_DETAILS"),icon:"pi pi-eye",command:()=>{this.showDetails(t)}},{label:this.translate.instant("EDIT"),icon:"pi pi-pencil",command:()=>{}},{label:this.translate.instant("DELETE"),icon:"pi pi-trash",command:()=>{this.deleteSaleReturn(t)}}]}deleteSaleReturn(t){let e=this.translate.instant("DELETE_ALERT",{name:t.barcode});this.confirmService.dialogAlert(e,()=>{this.saleReturnService.deleteSaleReturn(t.saleReturnId).subscribe(l=>{l.success?(this.toast.showSuccess(this.translate.instant("SAVE_SUCCESS")),this.getSaleReturnsPage()):this.toast.showError(l.message)})})}fetchSaleDetails(){this.loading=!0;let t=this.route.snapshot.queryParamMap.get("saleId");if(t){let e=Number.parseInt(t);e&&Number.isInteger(e)&&this.saleService.getSaleById(e).subscribe(l=>{l.success?(this.sale=l.data,this.tableHeader=this.translate.instant("ALL_SALE_RETURNS",{name:this.sale.barcode}),this.getSaleReturnsPage()):this.router.navigate(["/notfound"]),this.loading=!1})}else this.getSaleReturnsPage()}saleDetails(t){this.router.navigate(["sales/detail",t.saleId])}saleReturn(t){this.router.navigate(["sales/sale-return",t.saleId])}showDetails(t){this.router.navigate(["/sales/sale-return/detail",t.saleReturnId])}static \u0275fac=function(e){return new(e||n)(g(pe),g(U),g(J),g(he),g(ae),g(Y),g(O))};static \u0275cmp=w({type:n,selectors:[["app-sale-return-list"]],decls:16,vars:20,consts:[["start",""],["end",""],["dt",""],["caption",""],["header",""],["body",""],["menu",""],["styleClass","mb-6"],["dataKey","saleId",3,"selectionChange","value","rows","columns","loading","globalFilterFields","tableStyle","selection","rowHover"],["currentPageReportTemplate","Showing {first} to {last} of {totalRecords}",3,"onPageChange","first","rows","totalRecords","rowsPerPageOptions","showCurrentPageReport","showJumpToPageDropdown"],[1,"flex","items-center","gap-2"],["icon","pi pi-plus","severity","secondary",1,"mr-2",3,"label"],["severity","secondary","icon","pi pi-trash","outlined","",3,"label","disabled"],["icon","pi pi-upload","severity","secondary",3,"label"],[1,"flex","items-center","justify-between"],[1,"m-0"],["styleClass","pi pi-search"],["pInputText","","type","text",3,"input","placeholder"],[2,"width","3rem"],["pSortableColumn","returnDate"],["field","returnDate"],["pSortableColumn","sale.customer.fullName"],["field","sale.customer.fullName"],["pSortableColumn","subTotal"],["field","subTotal"],["pSortableColumn","feesAmount"],["field","feesAmount"],["pSortableColumn","totalAmount"],["field","totalAmount"],["pSortableColumn","returnedBy"],["field","returnedBy"],["pSortableColumn","sale.saleId"],["field","sale.saleId"],[3,"value"],[1,"text-primary","cursor-pointer","hover:underline",3,"click"],[1,"text-orange-500"],[1,"text-primary"],["appendTo","body",3,"popup","model"],["pButton","","icon","pi pi-ellipsis-v",1,"p-button-text",3,"click"]],template:function(e,l){if(e&1){let d=T();r(0,"p-toolbar",7),x(1,En,5,7,"ng-template",null,0,C)(3,Tn,2,3,"ng-template",null,1,C),a(),r(5,"p-table",8,2),z("selectionChange",function(b){return h(d),Q(l.selectedSales,b)||(l.selectedSales=b),I(b)}),x(7,Rn,7,4,"ng-template",null,3,C)(9,wn,37,27,"ng-template",null,4,C)(11,Dn,28,20,"ng-template",null,5,C),a(),r(13,"p-paginator",9),E("onPageChange",function(b){return h(d),I(l.onPageChange(b))}),a(),_(14,"p-confirmdialog")(15,"p-toast")}e&2&&(i(5),m("value",l.returnList)("rows",10)("columns",l.cols)("loading",l.loading)("globalFilterFields",v(16,In))("tableStyle",v(17,Cn)),$("selection",l.selectedSales),m("rowHover",!0),i(8),m("first",l.pageReq.page*l.pageReq.size)("rows",l.pageReq.size)("totalRecords",(l.pageDetails==null?null:l.pageDetails.totalElements)||0)("rowsPerPageOptions",v(18,bn))("showCurrentPageReport",!0)("showJumpToPageDropdown",!1),i(),y(v(19,yn)))},dependencies:[R,ee,Z,je,He,We,$e,D,L,Se,V,Qe,te,M,ve,Ye,ze,Ge,se,B,P,fe,_e,qe,ge,A,F,j],encapsulation:2})};var st=class{sale;returnItems;subTotal;feesAmount;totalAmount;constructor(t){this.sale=t,this.feesAmount=0,this.subTotal=0,this.totalAmount=0,this.returnItems=t.saleItems.map(e=>new pt(e,0))}fillCart(t){this.returnItems=t.saleItems.map(e=>new pt(e,e.quantity-e.returnedQuantity)),this.updateAmount()}increaseItemQty(t){let e=this.returnItems.find(l=>l.saleItem.saleItemId==t.saleItem.saleItemId);e&&e.quantity<e.saleItem.quantity-e.saleItem.returnedQuantity&&(e.quantity++,this.updateAmount())}decreaseItemQty(t){let e=this.returnItems.find(l=>l.saleItem.saleItemId==t.saleItem.saleItemId);e&&e.quantity>0&&(e.quantity--,this.updateAmount())}updateAmount(){let t=0;this.returnItems.forEach(e=>{t+=e.quantity*e.saleItem.unitPrice}),this.subTotal=t,this.totalAmount=this.subTotal-this.feesAmount}},pt=class{saleItem;quantity;constructor(t,e){this.saleItem=t,this.quantity=e}};var mt=class{saleId;returnItems;feesAmount;constructor(t){this.saleId=t.sale.saleId,this.feesAmount=t.feesAmount,this.returnItems=t.returnItems.filter(e=>e.quantity>0).map(e=>new St(e))}},St=class{saleItemId;quantity;constructor(t){this.saleItemId=t.saleItem.saleItemId,this.quantity=t.quantity}};var Pn=()=>({width:"450px"}),ii=()=>({"min-width":"50rem"}),Bn=()=>[1],Mn=()=>({width:"100%"}),An=()=>({width:"30%"}),Ln=()=>({width:"20%"}),ni=()=>({width:"25%"}),Nn=()=>({width:"3rem"}),gt=()=>({width:"50%"});function Fn(n,t){n&1&&(r(0,"div",6),_(1,"p-skeleton",7)(2,"p-skeleton",8)(3,"p-skeleton",9)(4,"p-skeleton",10)(5,"p-skeleton",11),a())}function kn(n,t){n&1&&(r(0,"div",30)(1,"span"),o(2),s(3,"translate"),a(),o(4),s(5,"translate"),a()),n&2&&(i(2),c(p(3,2,"NAME")),i(2),f(": ",p(5,4,"NOT_REGISTERED_CUSTOMER")," "))}function On(n,t){if(n&1&&(r(0,"div",30)(1,"span"),o(2),s(3,"translate"),a(),o(4),a()),n&2){let e=u(2);i(2),c(p(3,2,"NAME")),i(2),f(": ",e.sale.customer.fullName," ")}}function Vn(n,t){if(n&1&&(r(0,"div",30)(1,"span"),o(2),s(3,"translate"),a(),o(4,": "),r(5,"span",20),o(6),a()()),n&2){let e=u(2);i(2),c(p(3,2,"PHONE")),i(4),c(e.sale.customer.phone)}}function qn(n,t){if(n&1&&(r(0,"div",30)(1,"span"),o(2),s(3,"translate"),a(),o(4),a()),n&2){let e=u(2);i(2),c(p(3,2,"COUNTRY")),i(2),f(": ",e.sale.customer.country," ")}}function Un(n,t){if(n&1&&(r(0,"div",30)(1,"span"),o(2),s(3,"translate"),a(),o(4),a()),n&2){let e=u(2);i(2),c(p(3,2,"ADDRESS")),i(2),f(": ",e.sale.customer.address," ")}}function jn(n,t){if(n&1&&(r(0,"div",30)(1,"span"),o(2),s(3,"translate"),a(),o(4),a()),n&2){let e=u(2);i(2),c(p(3,2,"EMAIL")),i(2),f(": ",e.sale.customer.email," ")}}function Hn(n,t){n&1&&(r(0,"tr")(1,"th"),o(2),s(3,"translate"),a(),r(4,"th"),o(5),s(6,"translate"),a(),r(7,"th"),o(8),s(9,"translate"),a(),r(10,"th"),o(11),s(12,"translate"),a()()),n&2&&(i(2),c(p(3,4,"PRODUCT")),i(3),c(p(6,6,"UNIT_PRICE")),i(3),c(p(9,8,"QUANTITY_TO_RETURN")),i(3),c(p(12,10,"SUB_TOTAL")))}function Wn(n,t){if(n&1){let e=T();r(0,"span",35),E("click",function(){h(e);let d=u().$implicit,S=u(2);return I(S.returnCart.increaseItemQty(d))}),_(1,"span",36),a()}}function $n(n,t){if(n&1){let e=T();r(0,"span",35),E("click",function(){h(e);let d=u().$implicit,S=u(2);return I(S.returnCart.decreaseItemQty(d))}),_(1,"span",37),a()}}function Qn(n,t){if(n&1){let e=T();r(0,"tr")(1,"td",31)(2,"div",32),_(3,"img",33),r(4,"div"),o(5),s(6,"substring"),a()()(),r(7,"td"),o(8),s(9,"sCurrency"),a(),r(10,"td")(11,"p-inputnumber",34),z("ngModelChange",function(d){let S=h(e).$implicit;return Q(S.quantity,d)||(S.quantity=d),I(d)}),x(12,Wn,2,0,"ng-template",null,2,C)(14,$n,2,0,"ng-template",null,3,C),a()(),r(16,"td"),o(17),s(18,"sCurrency"),a()()}if(n&2){let e=t.$implicit,l=u(2);i(),y(v(24,An)),i(2),m("src",l.getProductImageSrc(e.saleItem.product),W)("alt",e.saleItem.product.basicDetails==null?null:e.saleItem.product.basicDetails.productName),i(2),c(N(6,17,e.saleItem.product.basicDetails.productName,"medium")),i(2),y(v(25,Ln)),i(),c(p(9,20,e.saleItem.unitPrice)),i(2),y(v(26,ni)),i(),$("ngModel",e.quantity),m("max",e.saleItem.quantity-e.saleItem.returnedQuantity)("showButtons",!0)("inputStyle",v(27,Nn)),i(5),y(v(28,ni)),i(),c(p(18,22,e.quantity*e.saleItem.unitPrice))}}function zn(n,t){n&1&&_(0,"tr")}function Yn(n,t){if(n&1&&(r(0,"tr")(1,"td"),o(2),s(3,"translate"),a(),r(4,"td"),o(5),s(6,"sCurrency"),a()(),r(7,"tr")(8,"td"),o(9),s(10,"translate"),a(),r(11,"td"),o(12),s(13,"sCurrency"),a()(),r(14,"tr")(15,"td"),o(16),s(17,"translate"),a(),r(18,"td",20),o(19),s(20,"sCurrency"),a()()),n&2){let e=u(2);i(2),c(p(3,12,"SUB_TOTAL")),i(2),y(v(24,gt)),i(),c(p(6,14,e.returnCart.subTotal)),i(4),c(p(10,16,"SALE_RETURN_FEES")),i(2),y(v(25,gt)),i(),c(p(13,18,e.returnCart.feesAmount)),i(4),c(p(17,20,"TOTAL_REFUND")),i(2),y(v(26,gt)),i(),c(p(20,22,e.returnCart.totalAmount))}}function Gn(n,t){if(n&1){let e=T();r(0,"div",12)(1,"div",13)(2,"div",14)(3,"span"),o(4),s(5,"translate"),a()(),r(6,"p-button",15),s(7,"translate"),E("onClick",function(){h(e);let d=u();return I(d.returnAll())}),yt(),r(8,"svg",16),_(9,"path",17),a()()(),Et(),r(10,"div",18)(11,"span",19),o(12),s(13,"translate"),a(),r(14,"span",20),o(15),a()(),r(16,"div",18)(17,"span",19),o(18),s(19,"translate"),a(),r(20,"span"),o(21),s(22,"dateFt"),a()(),r(23,"div",21)(24,"div",22),o(25),s(26,"translate"),a(),r(27,"div",23),x(28,kn,6,6,"div",24)(29,On,5,4,"div",24)(30,Vn,7,4,"div",24)(31,qn,5,4,"div",24)(32,Un,5,4,"div",24)(33,jn,5,4,"div",24),a()(),r(34,"div",18)(35,"span",19),o(36),s(37,"translate"),a(),r(38,"span"),o(39),a()(),r(40,"div",25)(41,"div",22),o(42),s(43,"translate"),a(),r(44,"p-table",26),x(45,Hn,13,12,"ng-template",null,0,C)(47,Qn,19,29,"ng-template",null,1,C),a(),r(49,"div",27)(50,"p-table",26),x(51,zn,1,0,"ng-template",null,0,C)(53,Yn,21,27,"ng-template",null,1,C),a()()(),r(55,"div",28)(56,"p-button",29),s(57,"translate"),E("onClick",function(){h(e);let d=u();return I(d.submitSaleReturn())}),a()()()}if(n&2){let e=u();i(4),c(p(5,26,"PRODUCTS_RETURN_REQUEST")),i(2),m("pTooltip",p(7,28,"RETURN_ALL"))("rounded",!0)("text",!0),i(6),c(p(13,30,"SALE")+": "),i(3),c(" "+e.sale.barcode+" "),i(3),c(p(19,32,"TIMESTAMP")+": "),i(3),c(N(22,34,e.sale.createdAt,"long")),i(4),f(" ",p(26,37,"CUSTOMER_DETAILS")," "),i(3),m("ngIf",!e.sale.customer),i(),m("ngIf",e.sale.customer),i(),m("ngIf",e.sale.customer),i(),m("ngIf",e.sale.customer&&e.sale.customer.country),i(),m("ngIf",e.sale.customer&&e.sale.customer.address),i(),m("ngIf",e.sale.customer&&e.sale.customer.email),i(3),c(p(37,39,"SOLD_BY")+": "),i(3),c(e.sale.createdBy),i(3),f(" ",p(43,41,"ORDER_DETAILS")," "),i(2),m("value",e.returnCart.returnItems)("tableStyle",v(45,ii)),i(6),m("value",v(46,Bn))("tableStyle",v(47,ii)),i(6),y(v(48,Mn)),m("loading",e.submitLoading)("label",p(57,43,"SUBMIT_RETURN_ORDER"))}}var ct=class n{constructor(t,e,l,d,S,b,Me){this.saleService=t;this.saleReturnService=e;this.route=l;this.toast=d;this.translate=S;this.confirmService=b;this.router=Me}sale;loading=!1;returnCart;submitLoading=!1;ngOnInit(){this.fetchSaleDetails()}fetchSaleDetails(){this.loading=!0;let t=this.route.snapshot.paramMap.get("saleId");if(t){let e=Number.parseInt(t);e&&Number.isInteger(e)&&this.saleService.getSaleById(e).subscribe(l=>{l.success?(this.sale=l.data,this.returnCart=new st(this.sale),console.log(this.sale)):this.router.navigate(["/notfound"]),this.loading=!1})}}submitSaleReturn(){let t=new mt(this.returnCart);if(!t.returnItems||!t.returnItems.length){this.toast.showWarn(this.translate.instant("EMPTY_SALE_RETURN_WARN_MSG"));return}this.submitLoading=!0,this.saleReturnService.createSaleReturn(t).subscribe(e=>{e.success?(this.toast.showSuccess(this.translate.instant("SAVE_SUCCESS")),this.fetchSaleDetails()):this.toast.showWarn(e.message),this.submitLoading=!1})}returnAll(){let t=this.translate.instant("RETURN_ALL_ALERT_MSG");this.confirmService.dialogAlert(t,()=>{this.returnCart.fillCart(this.sale),this.submitSaleReturn()})}getProductImageSrc(t){return H.getFirstImageSrc(t)}static \u0275fac=function(e){return new(e||n)(g(U),g(pe),g(Y),g(ae),g(J),g(he),g(O))};static \u0275cmp=w({type:n,selectors:[["app-sale-return-create"]],decls:5,vars:5,consts:[["header",""],["body",""],["incrementbuttonicon",""],["decrementbuttonicon",""],["class","loading",4,"ngIf"],["class","details",4,"ngIf"],[1,"loading"],["styleClass","mb-2"],["width","10rem","styleClass","mb-2"],["width","5rem","styleClass","mb-2"],["height","2rem","styleClass","mb-2"],["width","10rem","height","4rem"],[1,"details"],[1,"font-bold","text-lg","mb-4","flex","justify-between"],[1,"header"],["tooltipPosition","top","severity","success",3,"onClick","pTooltip","rounded","text"],["xmlns","http://www.w3.org/2000/svg","width","1em","height","1em","viewBox","0 0 14 14"],["fill","currentColor","fill-rule","evenodd","d","M6.545.998a1 1 0 0 0 0 2h2.728a2.638 2.638 0 0 1 0 5.275H4.817V6.545a1 1 0 0 0-1.707-.707L.384 8.564a1 1 0 0 0-.22 1.09q.073.18.218.327l2.728 2.728a1 1 0 0 0 1.707-.707v-1.729h4.456a4.638 4.638 0 1 0 0-9.275z","clip-rule","evenodd"],[1,"mb-4"],[1,"font-md","text-surface-400"],[1,"text-primary"],[1,"sale-customer","mb-4"],[1,"font-md","mb-2","text-surface-400"],[1,"ml-2","text-sm"],["class","mb-1",4,"ngIf"],[1,"order-summary","mb-4"],[3,"value","tableStyle"],[1,"mt-6"],[1,"flex","justify-center","w-full"],[3,"onClick","loading","label"],[1,"mb-1"],[1,"dark:text-primary-200"],[1,"flex","items-center","gap-2"],[1,"rounded","w-full",2,"width","3rem","height","3rem","object-fit","cover",3,"src","alt"],["readonly","true","min","0","buttonLayout","horizontal","spinnerMode","horizontal",3,"ngModelChange","ngModel","max","showButtons","inputStyle"],[1,"w-full","h-full","flex","items-center","justify-center",3,"click"],[1,"pi","pi-plus"],[1,"pi","pi-minus"]],template:function(e,l){e&1&&(r(0,"p-card"),x(1,Fn,6,0,"div",4)(2,Gn,58,49,"div",5),a(),_(3,"p-toast")(4,"p-confirmdialog")),e&2&&(i(),m("ngIf",l.loading),i(),m("ngIf",!l.loading),i(2),y(v(4,Pn)))},dependencies:[L,V,R,k,D,ue,Oe,K,X,M,ne,ie,A,Ie,B,P,ee,Z,le,G,xe,Ue,te,j,se],encapsulation:2})};var Jn=n=>["/sales/detail",n],ai=()=>({"min-width":"50rem"}),Xn=()=>[1],Kn=()=>({width:"30%"}),Zn=()=>({width:"20%"}),ri=()=>({width:"25%"}),xt=()=>({width:"50%"});function ea(n,t){n&1&&(r(0,"div",4),_(1,"p-skeleton",5)(2,"p-skeleton",6)(3,"p-skeleton",7)(4,"p-skeleton",8)(5,"p-skeleton",9),a())}function ta(n,t){n&1&&(r(0,"div",27)(1,"span"),o(2),s(3,"translate"),a(),o(4),s(5,"translate"),a()),n&2&&(i(2),c(p(3,2,"NAME")),i(2),f(": ",p(5,4,"NOT_REGISTERED_CUSTOMER")," "))}function ia(n,t){if(n&1&&(r(0,"div",27)(1,"span"),o(2),s(3,"translate"),a(),o(4),a()),n&2){let e=u(2);i(2),c(p(3,2,"NAME")),i(2),f(": ",e.saleReturn.sale.customer.fullName," ")}}function na(n,t){if(n&1&&(r(0,"div",27)(1,"span"),o(2),s(3,"translate"),a(),o(4,": "),r(5,"span",13),o(6),a()()),n&2){let e=u(2);i(2),c(p(3,2,"PHONE")),i(4),c(e.saleReturn.sale.customer.phone)}}function aa(n,t){if(n&1&&(r(0,"div",27)(1,"span"),o(2),s(3,"translate"),a(),o(4),a()),n&2){let e=u(2);i(2),c(p(3,2,"COUNTRY")),i(2),f(": ",e.saleReturn.sale.customer.country," ")}}function ra(n,t){if(n&1&&(r(0,"div",27)(1,"span"),o(2),s(3,"translate"),a(),o(4),a()),n&2){let e=u(2);i(2),c(p(3,2,"ADDRESS")),i(2),f(": ",e.saleReturn.sale.customer.address," ")}}function oa(n,t){if(n&1&&(r(0,"div",27)(1,"span"),o(2),s(3,"translate"),a(),o(4),a()),n&2){let e=u(2);i(2),c(p(3,2,"EMAIL")),i(2),f(": ",e.saleReturn.sale.customer.email," ")}}function la(n,t){n&1&&(r(0,"tr")(1,"th"),o(2),s(3,"translate"),a(),r(4,"th"),o(5),s(6,"translate"),a(),r(7,"th"),o(8),s(9,"translate"),a(),r(10,"th"),o(11),s(12,"translate"),a()()),n&2&&(i(),y(v(20,Kn)),i(),c(p(3,12,"PRODUCT")),i(2),y(v(21,Zn)),i(),c(p(6,14,"UNIT_PRICE")),i(2),y(v(22,ri)),i(),c(p(9,16,"RETURNED_QUANTITY")),i(2),y(v(23,ri)),i(),c(p(12,18,"SUB_TOTAL")))}function sa(n,t){if(n&1&&(r(0,"tr")(1,"td",28),_(2,"img",29),o(3),s(4,"substring"),a(),r(5,"td"),o(6),s(7,"sCurrency"),a(),r(8,"td"),o(9),a(),r(10,"td"),o(11),s(12,"sCurrency"),a()()),n&2){let e=t.$implicit,l=u(2);i(2),m("src",l.getProductImageSrc(e.saleItem.product),W)("alt",e.saleItem.product.basicDetails==null?null:e.saleItem.product.basicDetails.productName),i(),f(" ",N(4,6,e.saleItem.product.basicDetails.productName,"medium")," "),i(3),c(p(7,9,e.saleItem.unitPrice)),i(3),c(e.quantity),i(2),c(p(12,11,e.subTotal))}}function pa(n,t){n&1&&_(0,"tr")}function ma(n,t){if(n&1&&(r(0,"tr")(1,"td"),o(2),s(3,"translate"),a(),r(4,"td"),o(5),s(6,"sCurrency"),a()(),r(7,"tr")(8,"td"),o(9),s(10,"translate"),a(),r(11,"td"),o(12),s(13,"sCurrency"),a()(),r(14,"tr")(15,"td"),o(16),s(17,"translate"),a(),r(18,"td",13),o(19),s(20,"sCurrency"),a()()),n&2){let e=u(2);i(2),c(p(3,12,"GRAND_TOTAL")),i(2),y(v(24,xt)),i(),c(p(6,14,e.saleReturn.subTotal)),i(4),c(p(10,16,"EXTRA_FEES")),i(2),y(v(25,xt)),i(),c(p(13,18,e.saleReturn.feesAmount)),i(4),c(p(17,20,"TOTAL_REFUND")),i(2),y(v(26,xt)),i(),c(p(20,22,e.saleReturn.totalAmount))}}function ca(n,t){if(n&1&&(r(0,"div",10)(1,"div",11)(2,"div",12)(3,"span"),o(4),s(5,"translate"),a(),o(6,": "),r(7,"span",13),o(8),a()(),_(9,"p-button",14),s(10,"translate"),a(),r(11,"div",15)(12,"span",16),o(13),s(14,"translate"),a(),r(15,"span"),o(16),s(17,"dateFt"),a()(),r(18,"div",15)(19,"span",16),o(20),s(21,"translate"),a(),r(22,"a",17),o(23),a()(),r(24,"div",18)(25,"div",19),o(26),s(27,"translate"),a(),r(28,"div",20),x(29,ta,6,6,"div",21)(30,ia,5,4,"div",21)(31,na,7,4,"div",21)(32,aa,5,4,"div",21)(33,ra,5,4,"div",21)(34,oa,5,4,"div",21),a()(),r(35,"div",22)(36,"div",19),o(37),s(38,"translate"),a(),r(39,"p-table",23),x(40,la,13,24,"ng-template",null,0,C)(42,sa,13,13,"ng-template",null,1,C),a(),r(44,"div",24)(45,"p-table",23),x(46,pa,1,0,"ng-template",null,0,C)(48,ma,21,27,"ng-template",null,1,C),a()()(),r(50,"div",15)(51,"span",16),o(52),s(53,"translate"),a(),r(54,"span"),o(55),a()(),r(56,"div",25),_(57,"ngx-barcode6",26),a()()),n&2){let e=u();i(4),c(p(5,28,"SALE_RETURN_DETAILS")),i(4),c(" "+e.saleReturn.barcode+" "),i(),m("pTooltip",p(10,30,"PRINT_RECEIPT"))("rounded",!0)("text",!0),i(4),c(p(14,32,"TIMESTAMP")+": "),i(3),c(N(17,34,e.saleReturn.returnDate,"long")),i(4),c(p(21,37,"SALE")+": "),i(2),m("routerLink",re(45,Jn,e.saleReturn.sale.saleId)),i(),c(e.saleReturn.sale.barcode),i(3),f(" ",p(27,39,"CUSTOMER_DETAILS")," "),i(3),m("ngIf",!e.saleReturn.sale.customer),i(),m("ngIf",e.saleReturn.sale.customer),i(),m("ngIf",e.saleReturn.sale.customer),i(),m("ngIf",e.saleReturn.sale.customer&&e.saleReturn.sale.customer.country),i(),m("ngIf",e.saleReturn.sale.customer&&e.saleReturn.sale.customer.address),i(),m("ngIf",e.saleReturn.sale.customer&&e.saleReturn.sale.customer.email),i(3),f(" ",p(38,41,"ORDER_DETAILS")," "),i(2),m("value",e.saleReturn.returnItems)("tableStyle",v(47,ai)),i(6),m("value",v(48,Xn))("tableStyle",v(49,ai)),i(7),c(p(53,43,"RETURNED_BY")+": "),i(3),c(e.saleReturn.returnedBy),i(2),m("bc-width",3)("bc-format","CODE128")("bc-value",e.saleReturn.barcode)("bc-display-value",!0)}}var dt=class n{constructor(t,e,l){this.saleReturnService=t;this.route=e;this.router=l}saleReturn;loading=!1;ngOnInit(){this.fetchSaleDetails()}fetchSaleDetails(){this.loading=!0;let t=this.route.snapshot.paramMap.get("saleReturnId");if(t){let e=Number.parseInt(t);e&&Number.isInteger(e)&&this.saleReturnService.getSaleReturnById(e).subscribe(l=>{l.success?this.saleReturn=l.data:this.router.navigate(["/notfound"]),console.log(l),this.loading=!1})}}getProductImageSrc(t){return H.getFirstImageSrc(t)}static \u0275fac=function(e){return new(e||n)(g(pe),g(Y),g(O))};static \u0275cmp=w({type:n,selectors:[["app-sale-return-details"]],decls:3,vars:2,consts:[["header",""],["body",""],["class","loading",4,"ngIf"],["class","details",4,"ngIf"],[1,"loading"],["styleClass","mb-2"],["width","10rem","styleClass","mb-2"],["width","5rem","styleClass","mb-2"],["height","2rem","styleClass","mb-2"],["width","10rem","height","4rem"],[1,"details"],[1,"font-bold","text-lg","mb-4","flex","justify-between"],[1,"header"],[1,"text-primary"],["tooltipPosition","top","icon","pi pi-print","severity","success",3,"pTooltip","rounded","text"],[1,"mb-4"],[1,"font-md","text-muted-color"],[1,"text-primary","hover:underline",3,"routerLink"],[1,"sale-customer","mb-4"],[1,"font-md","mb-2","text-muted-color"],[1,"ml-2","text-sm"],["class","mb-1",4,"ngIf"],[1,"order-summary","mb-4"],[3,"value","tableStyle"],[1,"mt-6"],[1,"flex","justify-center","w-full"],[3,"bc-width","bc-format","bc-value","bc-display-value"],[1,"mb-1"],[1,"dark:text-primary-200","flex","items-center","gap-2"],[1,"rounded","w-full",2,"width","3rem","height","3rem","object-fit","cover",3,"src","alt"]],template:function(e,l){e&1&&(r(0,"p-card"),x(1,ea,6,0,"div",2)(2,ca,58,50,"div",3),a()),e&2&&(i(),m("ngIf",l.loading),i(),m("ngIf",!l.loading))},dependencies:[L,V,R,k,D,K,X,M,ne,ie,A,Ie,Xe,B,P,ee,Z,le,G,xe,j,F,oe],encapsulation:2})};var da=[{path:"pos",component:Pe},{path:"list",component:rt},{path:"detail/:saleId",component:lt},{path:"edit/:saleId",component:Pe},{path:"sale-return",children:[{path:"list",component:Be},{path:":saleId",component:Be},{path:"create/:saleId",component:ct},{path:"detail/:saleReturnId",component:dt}]}],ut=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=Ne({type:n});static \u0275inj=Ae({imports:[F.forChild(da),F]})};var oi=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=Ne({type:n});static \u0275inj=Ae({imports:[R,ut]})};export{oi as SalesModule};
